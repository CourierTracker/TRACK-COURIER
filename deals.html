<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Deals - Featured Products</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="favicon.png" type="image/png" />
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XQTH8T4YVN"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-XQTH8T4YVN');
  </script>
</head>
<body class="deals-page">

  <!-- Header / Navigation -->
  <header>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="services.html">Services</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <!-- Page Banner -->
    <section class="page-banner">
      <h1>Exclusive Deals</h1>
      <p>Grab these special deals while they last!</p>
    </section>

    <section class="checkout-section">
      <form id="customerForm" class="customer-info" autocomplete="on" novalidate>
        <h3>Enter Your Details</h3>

        <label for="customerName">Name</label>
        <input id="customerName" name="name" type="text" placeholder="Your name" required />

        <label for="customerEmail">Email</label>
        <input id="customerEmail" name="email" type="email" placeholder="you@example.com" required />

        <label for="customerAddress">Address</label>
        <textarea id="customerAddress" name="address" placeholder="Shipping address" required></textarea>
      </form>

      <div class="product-grid" aria-live="polite">
        <!-- Use data-amount in kobo (NGN * 100). Labels below show NGN -->
        <div class="product-card">
          <img src="dido.webp" alt="Masturbator dual vibrating toy product image" />
          <h3>Masturbator Dual Vibrating Female G-Spot Toy</h3>
          <button type="button" class="paystack-btn" data-amount="5900000" data-product="Masturbator Dual" disabled>
            Pay ₦59,000
          </button>
        </div>

        <div class="product-card">
          <img src="allsex.jpg" alt="3-in-1 couples vibrator product image" />
          <h3>Vibrator Flapping Sex Toy for Couples (3-in-1)</h3>
          <button type="button" class="paystack-btn" data-amount="9500000" data-product="3-in-1 Vibrator" disabled>
            Pay ₦95,000
          </button>
        </div>

        <div class="product-card">
          <img src="mensex.jpeg" alt="Male masturbator toy product image" />
          <h3>Vaginal Sex Male Masturbator Sex Toy For Men</h3>
          <button type="button" class="paystack-btn" data-amount="1800000" data-product="Male Masturbator" disabled>
            Pay ₦18,000
          </button>
        </div>

        <div class="product-card">
          <img src="singlesex.jpg" alt="Strong amateur vibrator product image" />
          <h3>Strong Amateur female students vibrator sensational</h3>
          <button type="button" class="paystack-btn" data-amount="2300000" data-product="Strong Vibrator" disabled>
            Pay ₦23,000
          </button>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer>
    <p>&copy; 2025 Courier Tracker. All rights reserved.</p>
  </footer>

  <!-- Paystack script -->
  <script src="https://js.paystack.co/v1/inline.js"></script>

  <script>
const form = document.getElementById('customerForm');
const nameInput = document.getElementById('customerName');
const emailInput = document.getElementById('customerEmail');
const addressInput = document.getElementById('customerAddress');
const payButtons = Array.from(document.querySelectorAll('.paystack-btn'));
const PAYSTACK_PUBLIC_KEY = 'pk_live_410ea0d7cf10bc1c518a2f1d96872cfab0231be7';

// Helper: check form validity
function isFormValid() {
  return nameInput.value.trim() !== '' &&
         addressInput.value.trim() !== '' &&
         emailInput.checkValidity();
}

// Enable/disable pay buttons
function updatePayButtons() {
  const valid = isFormValid();
  payButtons.forEach(btn => btn.disabled = !valid);
}

// Listen for changes
[nameInput, emailInput, addressInput].forEach(el => {
  el.addEventListener('input', updatePayButtons);
});

// Initial state
updatePayButtons();

// Click handler for Paystack buttons
payButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    // Check each field individually and scroll/focus
    if (nameInput.value.trim() === '') {
      alert('Please enter your name!');
      nameInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
      nameInput.focus();
      return;
    }

    if (!emailInput.checkValidity()) {
      alert('Please enter a valid email! Receipt will be sent there.');
      emailInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
      emailInput.focus();
      return;
    }

    if (addressInput.value.trim() === '') {
      alert('Please enter your address!');
      addressInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
      addressInput.focus();
      return;
    }

    // All fields valid → open Paystack
    const amount = parseInt(btn.dataset.amount, 10);
    const product = btn.dataset.product || 'Product';
    payWithPaystack(amount, emailInput.value.trim(), product);
  });
});

function payWithPaystack(amount, email, productName) {
  const name = nameInput.value.trim();
  const address = addressInput.value.trim();

  const handler = PaystackPop.setup({
    key: PAYSTACK_PUBLIC_KEY,
    email: email,
    amount: amount,
    currency: 'NGN',
    metadata: {
      custom_fields: [
        { display_name: "Name", variable_name: "name", value: name },
        { display_name: "Address", variable_name: "address", value: address },
        { display_name: "Product", variable_name: "product", value: productName }
      ]
    },
    callback: function(response){
      alert('Payment complete! Reference: ' + response.reference + '. Verifying on server...');
      fetch('/verify-payment', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ reference: response.reference })
      })
      .then(res => res.json())
      .then(data => {
        if (data && data.success) {
          alert('Payment verified by server. Thank you!');
        } else {
          alert('Payment could not be verified. Contact support with reference: ' + response.reference);
        }
      })
      .catch(err => {
        console.error('Verification error', err);
        alert('Error verifying payment. Contact support with reference: ' + response.reference);
      });
    },
    onClose: function(){
      alert('Payment cancelled.');
    }
  });

  handler.openIframe();
}
  </script>
  
</body>
</html>
